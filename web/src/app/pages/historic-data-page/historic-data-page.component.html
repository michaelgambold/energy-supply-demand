<mat-drawer-container class="p-4 h-screen">
  <!-- header -->
  <div class="flex justify-between">
    <h1>Historic Data</h1>
    <!-- time range & period selector -->
    <div class="flex justify-end gap-x-4">
      <mat-form-field>
        <mat-label>Time Range</mat-label>
        <mat-select
          [(value)]="selectedTimeRange"
          (selectionChange)="refreshData()"
        >
          <mat-option
            *ngFor="let timeRange of timeRanges"
            [value]="timeRange"
            >{{ timeRange }}</mat-option
          >
        </mat-select>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Period</mat-label>
        <mat-select [(value)]="selectedPeriod" (valueChange)="refreshData()">
          <mat-option *ngFor="let period of periods" [value]="period">{{
            period
          }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <!-- ./time range & period selector -->
  </div>
  <!-- ./header -->

  <!-- region tab bar -->
  <div class="pb-8" *ngIf="regions$ | async as regions; else spinner">
    <mat-tab-group (selectedTabChange)="onRegionTabChange($event, regions)">
      <mat-tab *ngFor="let region of regions" [label]="region.name"
        ><ng-container [ngTemplateOutlet]="regionData"></ng-container
      ></mat-tab>
    </mat-tab-group>
  </div>
  <!-- ./region tab bar -->

  <!-- <mat-card><mat-card-content>asdfsdff</mat-card-content></mat-card> -->
</mat-drawer-container>

<ng-template #regionData>
  <div class="pt-4" *ngIf="data$ | async as data; else spinner">
    <h2>{{ selectedRegion?.name }}</h2>
    <!-- fuel filters -->
    <app-line-chart
      *ngIf="data"
      [title]="'Generation'"
      [series]="data.metadata.fuels | fuelsToLineSeries"
      [data]="
        data.data
          | filterDataByRegion: selectedRegion.id
          | filterDataByPower: generatePowerId
          | dataToLineDataPoints: 'fuel'
      "
    ></app-line-chart>

    <app-line-chart
      *ngIf="data"
      [title]="'Demand'"
      [series]="data.metadata.fuels | fuelsToLineSeries"
      [data]="
        data.data
          | filterDataByRegion: selectedRegion.id
          | filterDataByPower: demandPowerId
          | dataToLineDataPoints: 'fuel'
      "
    ></app-line-chart>
  </div>
</ng-template>

<ng-template #spinner>
  <div class="flex justify-center py-16">
    <mat-spinner></mat-spinner>
  </div>
</ng-template>
